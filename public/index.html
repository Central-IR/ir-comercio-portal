<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="png" type="png" href="I.R.-COMERCIO-E-MATERIAIS-ELETRICOS-PRETO">
    <title>Portal</title>
    <style>
/* VARIÁVEIS BASE */
:root {
    --primary: #ff521d;
    --bg-primary: #FFFFFF;
    --bg-secondary: #FFFFFF;
    --bg-card: #FFFFFF;
    --text-primary: #000000;
    --text-secondary: #6B7280;
    --border-color: #E5E7EB;
    --input-bg: #F9FAFB;
    --success-color: #22C55E;
    --warning-color: #ff521d;
    --info-color: #3B82F6;
    --table-stripe: #FAFAFA;
    --table-hover: rgb(25, 25, 25);
    --card-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    --th-bg: #002045;
    --th-color: #FFFFFF;
    --th-border: #E5E7EB;
    --shadow: rgba(25, 25, 25);
    --btn-register: #3B82F6;
    --btn-delete: #EF4444;
    --btn-edit: #6B7280;
    --btn-view: #ff521d;
    --btn-save: #22C55E;
    --alert-color: #EF4444;
    --bg-sidebar: #FFFFFF;
}

@media (prefers-color-scheme: dark) {
    :root {
        --bg-primary: #000000;
        --bg-secondary: #000000;
        --bg-card: #1A1A1A;
        --text-primary: #FFFFFF;
        --text-secondary: #A0A0A0;
        --border-color: rgba(204, 112, 0, 0.08);
        --input-bg: #2A2A2A;
        --table-stripe: #1F1F1F;
        --table-hover: rgba(128, 128, 128, 0.15);
        --card-shadow: none;
        --th-bg: #5A5A5A;
        --th-color: #FFFFFF;
        --th-border: #5A5A5A;
        --shadow: rgba(0, 0, 0, 0.3);
        --bg-sidebar: #000000;
    }
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
    background: var(--bg-secondary);
    color: var(--text-primary);
    line-height: 1.6;
    overflow: hidden;
}

/* ─── LOGIN ─── */
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=Syne:wght@700;800&display=swap');

.login-screen {
    width: 100%;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
    background: linear-gradient(160deg, #f4f6f8 0%, #eef0f3 100%);
    font-family: 'DM Sans', sans-serif;
}

/* ── Linhas animadas passando por toda a tela ── */
.login-line {
    position: absolute;
    pointer-events: none;
    z-index: 0;
}
.login-line-h {
    left: -100%;
    width: 100%;
    height: 1px;
    background: linear-gradient(90deg, transparent 0%, rgba(255,82,29,0.25) 35%, rgba(255,82,29,0.38) 50%, rgba(255,82,29,0.25) 65%, transparent 100%);
    animation: lineSlideH linear infinite;
}
.login-line-v {
    top: -100%;
    height: 100%;
    width: 1px;
    background: linear-gradient(180deg, transparent 0%, rgba(255,82,29,0.25) 35%, rgba(255,82,29,0.38) 50%, rgba(255,82,29,0.25) 65%, transparent 100%);
    animation: lineSlideV linear infinite;
}
.login-line-h:nth-child(1) { top: 15%;  animation-delay: 0s;   animation-duration: 10s; }
.login-line-h:nth-child(2) { top: 47%;  animation-delay: -4s;  animation-duration: 13s; }
.login-line-h:nth-child(3) { top: 80%;  animation-delay: -7s;  animation-duration:  9s; }
.login-line-v:nth-child(4) { left: 15%; animation-delay: -2s;  animation-duration: 11s; }
.login-line-v:nth-child(5) { left: 55%; animation-delay: -6s;  animation-duration: 14s; }
.login-line-v:nth-child(6) { left: 82%; animation-delay: -9s;  animation-duration: 10s; }
@keyframes lineSlideH { from { transform: translateX(0); } to { transform: translateX(200%); } }
@keyframes lineSlideV { from { transform: translateY(0); } to { transform: translateY(200%); } }

/* ── Formulário centralizado (sem card/modal) ── */
.login-form-area {
    position: relative;
    z-index: 20;
    width: 100%;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Logo — fade-in suave ao carregar */
.login-logo-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 0.4rem;
    margin-bottom: 1rem;
    animation: portalFadeIn 1.8s ease forwards;
}

.login-logo-light,
.login-logo-dark {
    height: auto;
    display: block;
}

.login-logo-light { max-width: 185px; }
.login-logo-dark  { max-width: 148px; }

/* Mostrar logo correta conforme tema */
.login-logo-light { display: block; }
.login-logo-dark  { display: none;  }

@media (prefers-color-scheme: dark) {
    .login-logo-light { display: none;  }
    .login-logo-dark  { display: block; }
}

@keyframes portalFadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to   { opacity: 1; transform: translateY(0);   }
}

.login-portal-sub {
    font-size: 0.72rem;
    font-weight: 500;
    letter-spacing: 0.06em;
    color: #6B7280;
    text-align: center;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
    animation: portalFadeIn 1.8s ease 0.15s both;
}

.login-portal-headline {
    font-size: 0.85rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    color: #374151;
    text-align: center;
    text-transform: uppercase;
    margin-bottom: 2rem;
    animation: portalFadeIn 1.8s ease 0.25s both;
}

/* Campos */
.login-fields { width: 100%; }
.form-group { margin-bottom: 1.4rem; }

label {
    display: block;
    margin-bottom: 0.4rem;
    font-weight: 500;
    color: #6b7280;
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.07em;
}

input {
    width: 100%;
    padding: 12px 15px;
    border: 1.5px solid #c8cdd6;
    border-radius: 8px;
    background: #f7f8fa;
    color: #111111;
    font-size: 0.92rem;
    font-family: 'DM Sans', sans-serif;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
    box-shadow: 0 1px 4px rgba(0,0,0,0.07);
}
input::placeholder { color: #adb3bd; }
input:focus {
    outline: none;
    border-color: #F97316;
    background: #ffffff;
    box-shadow: 0 0 0 3px rgba(249,115,22,0.12);
}

.password-container { position: relative; }
.toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.67rem;
    color: #9ca3af;
    font-weight: 600;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    font-family: 'DM Sans', sans-serif;
    padding: 4px 6px;
    transition: color 0.2s;
}
.toggle-password:hover { color: var(--primary); }

/* Botão Entrar — shimmer como único efeito */
.btn-login {
    width: 100%;
    padding: 15px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 0.88rem;
    font-weight: 700;
    font-family: 'DM Sans', sans-serif;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-top: 1rem;
    position: relative;
    overflow: hidden;
}
.btn-login::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.22), transparent);
    transition: left 0.45s ease;
}
.btn-login:hover:not(:disabled)::before { left: 100%; }
.btn-login:hover:not(:disabled) {
    background: #e8451a;
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(255,82,29,0.35);
}
.btn-login:active:not(:disabled) { transform: translateY(0); }
.btn-login:disabled { opacity: 0.45; cursor: not-allowed; }

/* Mensagens — agora abaixo do botão */
.message {
    position: absolute;
    top: -3.8rem;
    left: 1.5rem;
    right: 1.5rem;
    padding: 9px 13px;
    border-radius: 8px;
    font-size: 0.82rem;
    font-weight: 500;
    opacity: 0;
    transform: translateY(4px);
    pointer-events: none;
    transition: opacity 0.25s ease, transform 0.25s ease;
}
.message.show {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}
.message.error   { background: #EF4444; border: none; color: #ffffff; font-weight: 700; }

.login-version-footer {
    position: absolute;
    bottom: 1.4rem;
    left: 0; right: 0;
    text-align: center;
    font-size: 0.7rem;
    font-weight: 500;
    color: #b0b7c3;
    letter-spacing: 0.04em;
    pointer-events: none;
    z-index: 20;
}


/* ── CARD CORPORATIVO ── */
.login-card {
    background: #ffffff;
    border-radius: 20px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.04), 0 12px 40px rgba(0,0,0,0.10);
    padding: 2.8rem 2.4rem 2.4rem;
    width: 100%;
    max-width: 420px;
    position: relative;
    z-index: 20;
    animation: portalFadeIn 0.6s ease forwards;
}

/* ── INPUT COM ÍCONE ── */
.input-icon-wrapper {
    position: relative;
}
.input-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    width: 18px; height: 18px;
    display: flex; align-items: center; justify-content: center;
    color: #adb3bd;
    pointer-events: none;
    transition: color 0.2s ease;
}
.input-icon svg {
    width: 100%; height: 100%;
    stroke: currentColor; fill: none;
    stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
}
.input-icon-wrapper input:focus ~ .input-icon,
.input-icon-wrapper:focus-within .input-icon {
    color: #F97316;
}

/* ── SPINNER NO BOTÃO ── */
.btn-spinner {
    display: inline-block;
    width: 14px; height: 14px;
    border: 2px solid rgba(255,255,255,0.35);
    border-top-color: #ffffff;
    border-radius: 50%;
    animation: splashSpin 0.7s linear infinite;
    vertical-align: middle;
    margin-right: 6px;
}

/* ── TEMA ESCURO ── */
@media (prefers-color-scheme: dark) {
    .login-screen    { background: linear-gradient(160deg, #0c0c0e 0%, #111114 100%); }
    .login-card       { background: #1a1a1a; box-shadow: 0 4px 6px rgba(0,0,0,0.2), 0 12px 40px rgba(0,0,0,0.4); }
    .input-icon       { color: rgba(255,255,255,0.25); }
    .login-version-footer { color: rgba(255,255,255,0.18); }
    .login-portal-sub   { color: rgba(255,255,255,0.3); }
    .login-portal-headline { color: rgba(255,255,255,0.7); }
    label { color: rgba(255,255,255,0.4); }
    input {
        background: #2a2a2a;
        border: 1.5px solid rgba(255,255,255,0.22);
        color: #ffffff;
        box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }
    input::placeholder { color: rgba(255,255,255,0.35); }
    input:focus {
        border-color: rgba(255,82,29,0.55);
        background: rgba(255,255,255,0.07);
        box-shadow: 0 0 0 3px rgba(255,82,29,0.1);
    }
    .toggle-password { color: rgba(255,255,255,0.28); }
    .message.error   { background: #EF4444; border: none; color: #ffffff; font-weight: 700; }
    .login-line-h {
        background: linear-gradient(90deg, transparent 0%, rgba(255,82,29,0.18) 35%, rgba(255,82,29,0.28) 50%, rgba(255,82,29,0.18) 65%, transparent 100%);
    }
    .login-line-v {
        background: linear-gradient(180deg, transparent 0%, rgba(255,82,29,0.18) 35%, rgba(255,82,29,0.28) 50%, rgba(255,82,29,0.18) 65%, transparent 100%);
    }
}

@media (max-width: 480px) {
    .login-form-area { padding: 0 1.25rem; }
    .login-logo-wrapper img { max-width: 170px; }
}

/* ─── DASHBOARD ─── */
.dashboard-screen {
    display: none;
    height: 100vh;
    overflow: hidden;
}

/* SPLASH */
.splash-welcome {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: var(--bg-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 99999;
}

/* Spinner */
.splash-spinner {
    width: 52px;
    height: 52px;
    border: 4px solid rgba(255, 82, 29, 0.15);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: splashSpin 0.8s linear infinite;
}
@keyframes splashSpin { to { transform: rotate(360deg); } }
@keyframes fadeOut { to { opacity:0; visibility:hidden; } }

/* ─── LAYOUT PRINCIPAL ─── */
.dashboard-container {
    display: flex;
    height: 100vh;
    overflow: hidden;
}

/* ─── SIDEBAR ─── */
.sidebar {
    background: var(--bg-sidebar);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 100;
    flex-shrink: 0;
    height: 100vh;
    overflow: hidden;
    width: 0;
    opacity: 0;
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                box-shadow 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}
.sidebar.visible {
    width: 70px;
    opacity: 1;
    pointer-events: all;
}
.sidebar.visible.expanded {
    width: 280px;
    box-shadow: 4px 0 20px rgba(0,0,0,0.1);
}

.sidebar-header {
    padding: 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-shrink: 0;
    height: 70px;
    min-height: 70px;
    max-height: 70px;
    overflow: hidden;
}

.user-initial-circle {
    background: #6B7280;
    color: white;
    width: 40px; height: 40px;
    min-width: 40px; min-height: 40px;
    max-width: 40px; max-height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    font-weight: 700;
    flex-shrink: 0;
    text-transform: uppercase;
}

.sidebar-title {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    flex: 1;
    min-width: 0;
    overflow: hidden;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.2s ease;
}
.sidebar.visible.expanded .sidebar-title { opacity: 1; }

.user-name-sidebar {
    font-size: 1.05rem;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.3;
}
.user-sector-sidebar {
    font-size: 0.9rem;
    color: var(--text-secondary);
    line-height: 1.2;
}

.sidebar-modules {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 0.5rem 0;
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    transition: scrollbar-color 0.3s ease;
}
.sidebar.visible.expanded .sidebar-modules:hover {
    scrollbar-color: rgba(136,136,136,0.5) transparent;
}
.sidebar-modules::-webkit-scrollbar { width: 8px; }
.sidebar-modules::-webkit-scrollbar-track { background: transparent; }
.sidebar-modules::-webkit-scrollbar-thumb { background: transparent; border-radius: 4px; }
.sidebar.visible.expanded .sidebar-modules:hover::-webkit-scrollbar-thumb { background: rgba(136,136,136,0.5); }

.sidebar-footer {
    padding: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    min-height: 60px;
    border-top: 1px solid var(--border-color);
}

.logout-btn-footer {
    width: 100%;
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 0.75rem;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
    border: none;
    background: transparent;
    color: var(--btn-delete);
    font-size: 0.9rem;
    font-weight: 600;
    border-radius: 8px;
    overflow: hidden;
    white-space: nowrap;
}
.logout-btn-footer:hover { background: rgba(239,68,68,0.1); transform: translateY(-1px); }
.logout-btn-footer .logout-label { opacity: 0; transition: opacity 0.2s ease; }
.sidebar.visible.expanded .logout-btn-footer .logout-label { opacity: 1; }

.logout-icon {
    width: 20px; height: 20px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
}
.logout-icon svg {
    width: 100%; height: 100%;
    stroke: currentColor; fill: none;
    stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
}

/* ─── MODULE ITEMS ─── */
.module-item {
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
    border-left: 3px solid transparent;
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 500;
    position: relative;
    white-space: nowrap;
    overflow: hidden;
}
.module-item .module-label { opacity: 0; transition: opacity 0.2s ease; }
.sidebar.visible.expanded .module-item .module-label { opacity: 1; }

.sidebar.visible:not(.expanded) .module-item::before {
    content: attr(data-tooltip);
    position: absolute;
    left: 100%; top: 50%;
    transform: translateY(-50%) translateX(-5px);
    background: var(--bg-card);
    color: var(--text-primary);
    padding: 0.5rem 0.9rem;
    border-radius: 8px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease, transform 0.2s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border: 1px solid var(--border-color);
    z-index: 1000;
    font-size: 0.85rem;
    font-weight: 500;
}
.sidebar.visible:not(.expanded) .module-item:hover::before {
    opacity: 1; transform: translateY(-50%) translateX(5px);
}

.module-item:hover { background: rgba(255,81,0,0.1); color: var(--text-primary); }
.module-item.active {
    background: rgba(255,81,0,0.15);
    color: var(--primary);
    border-left-color: var(--primary);
    font-weight: 600;
}

.module-icon {
    width: 20px; height: 20px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    transition: transform 0.2s ease;
}
.module-item:hover .module-icon { transform: scale(1.1); }
.module-icon svg {
    width: 100%; height: 100%;
    stroke: currentColor; fill: none;
    stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
}

/* ─── MAIN CONTENT ─── */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
}

.content-area {
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    position: relative;
}

/* ─── TELA DE BOAS-VINDAS ─── */
.welcome-screen {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    gap: 2rem;
    opacity: 1;
    visibility: visible;
    transition: opacity 0.5s cubic-bezier(0.4,0,0.2,1), visibility 0.5s cubic-bezier(0.4,0,0.2,1);
    overflow-y: auto;
    z-index: 10;
}
.welcome-screen.hidden-smooth { opacity: 0; visibility: hidden; pointer-events: none; }

.welcome-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.3rem;
    text-align: center;
}
.welcome-greeting-text {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-primary);
    letter-spacing: -0.5px;
}
.welcome-title {
    font-size: 1rem;
    font-weight: 400;
    color: var(--text-secondary);
    text-align: center;
}

/* GRID DE CARDS */
.welcome-modules-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 0.6rem;
    width: 100%;
    max-width: 1100px;
}

.welcome-module-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.85rem;
    padding: 2rem 1.5rem;
    background: var(--bg-card);
    border: 1.5px solid var(--border-color);
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.22s cubic-bezier(0.4,0,0.2,1);
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 600;
    text-align: center;
    user-select: none;
    position: relative;
    overflow: hidden;
}
.welcome-module-card::before {
    content: '';
    position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(255,81,0,0.04) 0%, transparent 70%);
    opacity: 0; transition: opacity 0.22s ease;
}
.welcome-module-card:hover::before { opacity: 1; }
.welcome-module-card:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(255,81,0,0.15);
}
.welcome-module-card:active { transform: translateY(-1px); }
.welcome-module-card.unavailable { opacity: 0.4; cursor: not-allowed; pointer-events: none; }

.card-icon {
    width: 36px; height: 36px;
    display: flex; align-items: center; justify-content: center;
    transition: transform 0.22s ease;
}
.welcome-module-card:hover .card-icon { transform: scale(1.15); }
.card-icon svg {
    width: 100%; height: 100%;
    stroke: currentColor; fill: none;
    stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
}

/* ─── BOTÃO SAIR FLUTUANTE ─── */
.logout-btn-floating {
    position: fixed;
    top: 1.25rem; right: 1.25rem;
    z-index: 200;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.55rem 1rem 0.55rem 0.75rem;
    border: 1.5px solid var(--border-color);
    border-radius: 10px;
    background: var(--bg-card);
    color: var(--btn-delete);
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    opacity: 1; visibility: visible;
    transition: opacity 0.4s ease, visibility 0.4s ease,
                background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
}
.logout-btn-floating:hover {
    background: rgba(239,68,68,0.07);
    border-color: var(--btn-delete);
    box-shadow: 0 4px 14px rgba(239,68,68,0.15);
}
.logout-btn-floating.hidden-smooth { opacity: 0; visibility: hidden; pointer-events: none; }
.logout-btn-floating svg {
    width: 18px; height: 18px; flex-shrink: 0;
    stroke: currentColor; fill: none;
    stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
}

/* ─── APP LOADER ─── */
.app-loader {
    position: absolute; inset: 0;
    display: flex; align-items: center; justify-content: center;
    background: var(--bg-primary);
    z-index: 5; opacity: 1;
    transition: opacity 0.35s ease;
    pointer-events: none;
}
.app-loader.done { opacity: 0; }
.app-loader-spinner {
    width: 52px; height: 52px;
    border: 4px solid rgba(255, 82, 29, 0.15);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: splashSpin 0.8s linear infinite;
}

/* ─── IFRAMES ─── */
#iframesContainer { flex: 1; width: 100%; height: 100%; position: relative; }
.iframe-container {
    display: block; width: 100%; height: 100%;
    position: absolute; inset: 0;
    opacity: 0; visibility: hidden; transform: scale(0.98);
    transition: opacity 0.35s cubic-bezier(0.4,0,0.2,1),
                visibility 0.35s cubic-bezier(0.4,0,0.2,1),
                transform 0.35s cubic-bezier(0.4,0,0.2,1);
}
.iframe-container.active { opacity: 1; visibility: visible; transform: scale(1); }
.iframe-container iframe { width: 100%; height: 100%; border: none; }

/* ─── MODAL LOGOUT ─── */
.modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(4px);
    align-items: center; justify-content: center;
    z-index: 100000; opacity: 0;
    animation: modalFadeIn 0.2s ease forwards;
}
.modal-overlay.show { display: flex; }
@keyframes modalFadeIn { to { opacity:1; } }

.modal-content {
    background: var(--bg-card);
    border-radius: 16px;
    padding: 2.5rem 2rem 2rem;
    max-width: 500px; width: 95%;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    border: 1px solid var(--border-color);
    transform: scale(0.9);
    animation: scaleIn 0.2s ease forwards;
    position: relative;
}
@keyframes scaleIn { to { transform:scale(1); } }

.close-modal {
    position: absolute; top: 1rem; right: 1rem;
    background: transparent !important; border: none !important;
    font-size: 1.5rem; color: var(--text-secondary);
    cursor: pointer; padding: 0 !important;
    width: 32px; height: 32px;
    display: flex; align-items: center; justify-content: center;
    transition: color 0.2s ease;
}
.close-modal:hover { color: var(--text-primary); }

.modal-message-logout {
    margin: 2rem 0 2.5rem;
    color: var(--text-primary);
    font-size: 1.25rem; line-height: 1.6;
    text-align: center; font-weight: 500;
}

.modal-actions { display: flex; gap: 0.75rem; justify-content: center; }
.modal-actions button {
    min-width: 120px; padding: 12px 24px;
    border-radius: 8px; cursor: pointer;
    font-size: 0.95rem; font-weight: 600;
    border: none; transition: all 0.3s ease;
}
.modal-actions button.danger { background: var(--btn-delete); color: white; }
.modal-actions button.danger:hover { opacity: 0.9; transform: translateY(-1px); }
.modal-actions button.secondary { background: #6B7280; color: white; }
.modal-actions button.secondary:hover { opacity: 0.9; transform: translateY(-1px); }

.hidden { display: none !important; }

/* ─── RESPONSIVO ─── */
@media (max-width: 768px) {
    .welcome-modules-grid { grid-template-columns: repeat(3, 1fr); }
    .welcome-module-card { padding: 1.5rem 1rem; }
    .sidebar.visible.expanded {
        position: fixed; left: 0; top: 0;
        height: 100vh; z-index: 1000;
    }
}
    </style>
</head>
<body>

    <!-- ── LOGIN ── -->
    <div id="loginScreen" class="login-screen">

        <!-- Linhas animadas (toda a tela, passam por trás do formulário) -->
        <div class="login-line login-line-h"></div>
        <div class="login-line login-line-h"></div>
        <div class="login-line login-line-h"></div>
        <div class="login-line login-line-v"></div>
        <div class="login-line login-line-v"></div>
        <div class="login-line login-line-v"></div>

        <!-- Card corporativo -->
        <div class="login-card">
        <div class="login-form-area">

            <!-- Aviso flutuante acima da logo -->
            <div id="messageBox" class="message"></div>

            <!-- Logo: tema claro = I.R.PRETO.png (logo escura sobre fundo branco) | tema escuro = I.R.BRANCO.png (logo clara sobre fundo escuro) -->
            <div class="login-logo-wrapper">
                <img src="I.R.PRETO.png"  alt="IR Comércio e Materiais Elétricos" class="login-logo-light">
                <img src="I.R.BRANCO.png" alt="IR Comércio e Materiais Elétricos" class="login-logo-dark">
            </div>

            <div class="login-portal-sub">IR<span style="color: rgba(255, 140, 60, 0.55);">2</span> COMÉRCIO E MATERIAIS ELÉTRICOS LTDA</div>
            <div class="login-portal-headline">Faça login para acessar o portal</div>

            <div class="login-fields">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Usuário</label>
                        <div class="input-icon-wrapper">
                            <span class="input-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
                            </span>
                            <input type="text" id="username" name="username" required autofocus
                                   placeholder="Digite seu usuário" autocomplete="username" style="padding-left:2.6rem;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="password">Senha</label>
                        <div class="password-container input-icon-wrapper">
                            <span class="input-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                            </span>
                            <input type="password" id="password" name="password" required
                                   placeholder="Digite sua senha" autocomplete="current-password" style="padding-left:2.6rem;">
                            <button type="button" class="toggle-password" onclick="togglePassword()">MOSTRAR</button>
                        </div>
                    </div>
                    <button type="submit" class="btn-login" id="loginBtn">Acessar Sistema</button>

                </form>
            </div>
        </div>

        </div><!-- /.login-card -->

        <!-- Rodapé versão -->
        <div class="login-version-footer">Versão 1.0.0 &nbsp;·&nbsp; © 2026 IR<span style="color: rgba(255, 140, 60, 0.55);">2</span> COMÉRCIO E MATERIAIS ELÉTRICOS LTDA &nbsp;·&nbsp; Uso interno</div>
    </div>

    <!-- ── DASHBOARD ── -->
    <div id="dashboardScreen" class="dashboard-screen">

        <div class="splash-welcome" id="splashWelcome">
            <div class="splash-spinner"></div>
        </div>

        <button class="logout-btn-floating" id="logoutFloatingBtn" onclick="showLogoutModal()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
            Sair
        </button>

        <div class="dashboard-container">

            <div id="sidebar" class="sidebar">
                <div class="sidebar-header">
                    <div class="user-initial-circle" id="userInitial"></div>
                    <div class="sidebar-title">
                        <div class="user-name-sidebar" id="sidebarUserName"></div>
                        <div class="user-sector-sidebar" id="sidebarUserSector"></div>
                    </div>
                </div>

                <div class="sidebar-modules" id="sidebarModules"></div>

                <div class="sidebar-footer">
                    <button class="logout-btn-footer" onclick="showLogoutModal()">
                        <span class="logout-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                <polyline points="16 17 21 12 16 7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                        </span>
                        <span class="logout-label">Sair</span>
                    </button>
                </div>
            </div>

            <div class="main-content">
                <div class="content-area">
                    <div id="welcomeScreen" class="welcome-screen">
                        <div class="welcome-header">
                            <div class="welcome-greeting-text" id="welcomeGreeting"></div>
                            <div class="welcome-title">Selecione um módulo para começar</div>
                        </div>
                        <div id="welcomeModulesGrid" class="welcome-modules-grid"></div>
                    </div>

                    <div id="iframesContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL LOGOUT -->
    <div class="modal-overlay" id="logoutModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeLogoutModal()">✕</button>
            <div class="modal-message-logout">Deseja realmente sair?</div>
            <div class="modal-actions">
                <button type="button" onclick="confirmLogout()" class="danger">Sim</button>
                <button type="button" onclick="closeLogoutModal()" class="secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = window.location.origin + '/api';

        /* ── PERMISSÕES ── */
        const SECTOR_PERMISSIONS = {
            'Administrador': ['pregões','tabela-precos','compra','transportadoras','cotacoes-frete','faturamento','estoque','controle-frete','receber','vendas','pagamento','comercial'],
            'Vendas':        ['pregões','tabela-precos','compra','transportadoras','cotacoes-frete','faturamento','estoque','controle-frete','comercial'],
            'Financeiro':    ['pregões','transportadoras','faturamento','controle-frete','receber','pagamento','comercial'],
            'Almoxarifado':  ['transportadoras','cotacoes-frete','faturamento','estoque','controle-frete','comercial'],
            'Suporte':       ['pregões','tabela-precos','compra','transportadoras','cotacoes-frete','faturamento','estoque','controle-frete','receber','vendas','pagamento','comercial']
        };

        const FINANCEIRO1_PERMS = ['pregões','transportadoras','faturamento','controle-frete','receber','pagamento','comercial'];
        const VENDAS_PERMS      = ['pregões','tabela-precos','compra','transportadoras','cotacoes-frete','faturamento','estoque','controle-frete','comercial'];

        const USER_SPECIFIC_PERMISSIONS = {
            'rosemeire':  ['pregões','tabela-precos','compra','transportadoras','cotacoes-frete','faturamento','estoque','controle-frete','receber','vendas','pagamento','lucro-real','comercial'],
            'roberto':    ['pregões','tabela-precos','compra','transportadoras','cotacoes-frete','faturamento','estoque','controle-frete','receber','vendas','pagamento','lucro-real','comercial'],
            'financeiro1': FINANCEIRO1_PERMS,
            'vendas2':    [...VENDAS_PERMS, 'vendas-miguel'],
            'vendas':     [...VENDAS_PERMS, 'vendas-isaque'],
            'almox':      ['transportadoras','cotacoes-frete','faturamento','estoque','controle-frete','comercial'],
            'suporte':    ['pregões','tabela-precos','compra','transportadoras','cotacoes-frete','faturamento','estoque','controle-frete','receber','vendas','pagamento','comercial']
        };

        /* ── ÍCONES ── */
        const MODULE_ICONS = {
            'pregões':          '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m14 13-8.381 8.38a 1 1 0 0 1-3.001-3l8.384-8.381"/><path d="m16 16 6-6"/><path d="m21.5 10.5-8-8"/><path d="m8 8 6-6"/><path d="m8.5 7.5 8 8"/></svg>',
            'tabela-precos':    '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 13H7"/><path d="M19 9h-4"/><path d="M3 3v16a2 2 0 0 0 2 2h16"/><rect x="15" y="5" width="4" height="12" rx="1"/><rect x="7" y="8" width="4" height="9" rx="1"/></svg>',
            'compra':           '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>',
            'transportadoras':  '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M15 18H9"/><path d="M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14"/><circle cx="17" cy="18" r="2"/><circle cx="7" cy="18" r="2"/></svg>',
            'cotacoes-frete':   '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"/><path d="m7.5 4.27 9 5.15"/><polyline points="3.29 7 12 12 20.71 7"/><line x1="12" x2="12" y1="22" y2="12"/><circle cx="18.5" cy="15.5" r="2.5"/><path d="M20.27 17.27 22 19"/></svg>',
            'faturamento':      '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-1"/><path d="M14 2v5a1 1 0 0 0 1 1h5"/><path d="M2 15h10"/><path d="m9 18 3-3-3-3"/></svg>',
            'estoque':          '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>',
            'controle-frete':   '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"/><circle cx="12" cy="10" r="3"/></svg>',
            'receber':          '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 18H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5"/><path d="m16 19 3 3 3-3"/><path d="M18 12h.01"/><path d="M19 16v6"/><path d="M6 12h.01"/><circle cx="12" cy="12" r="2"/></svg>',
            'vendas':           '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>',
            'vendas-miguel':    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>',
            'vendas-isaque':    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>',
            'pagamento':        '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 18H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5"/><path d="M18 12h.01"/><path d="M19 22v-6"/><path d="m22 19-3-3-3 3"/><path d="M6 12h.01"/><circle cx="12" cy="12" r="2"/></svg>',
            'lucro-real':       '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>',
            'comercial':        '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg>'
        };

        /* ── MÓDULOS ── */
        const MODULES = [
            { id: 'pregões',        name: 'Pregões',               url: '',                                          available: false },
            { id: 'tabela-precos',  name: 'Tabela de Preços',      url: 'https://tabela-precos-udyp.onrender.com',   available: true  },
            { id: 'compra',         name: 'Ordens de Compra',      url: 'https://ordem-compra.onrender.com',         available: true  },
            { id: 'transportadoras',name: 'Transportadoras',       url: 'https://transportadoras.onrender.com',      available: true  },
            { id: 'cotacoes-frete', name: 'Cotações de Frete',     url: 'https://cotacoes-frete-aikc.onrender.com',  available: true  },
            { id: 'faturamento',    name: 'Pedidos de Faturamento',url: 'https://pedido-faturamento.onrender.com',   available: true  },
            { id: 'estoque',        name: 'Estoque',               url: 'https://controle-estoque-0eme.onrender.com',available: true  },
            { id: 'controle-frete', name: 'Controle de Frete',     url: 'https://controle-frete.onrender.com',       available: true  },
            { id: 'receber',        name: 'Contas a Receber',      url: 'https://contas-receber-m1xw.onrender.com',  available: true  },
            { id: 'vendas',         name: 'Vendas',                url: 'https://vendas-qdpf.onrender.com',          available: true  },
            { id: 'vendas-miguel',  name: 'Vendas',                url: 'https://vendas-miguel.onrender.com',        available: true  },
            { id: 'vendas-isaque',  name: 'Vendas',                url: 'https://vendas-isaque.onrender.com',        available: true  },
            { id: 'pagamento',      name: 'Contas a Pagar',        url: 'https://contas-a-pagar-ytr6.onrender.com',  available: true  },
            { id: 'lucro-real',     name: 'Lucro Real',            url: '',                                          available: false },
            { id: 'comercial',      name: 'Documentos',            url: '',                                          available: false }
        ];

        let deviceToken        = null;
        let publicIP           = null;
        let currentSessionInfo = null;
        let activeModuleId     = null;
        let hoverTimeout       = null;
        let sidebarRevealed    = false;

        /* ── HELPERS ── */
        function getUserPermissions(sessionInfo) {
            const username = sessionInfo.username?.toLowerCase();
            if (USER_SPECIFIC_PERMISSIONS[username]) return USER_SPECIFIC_PERMISSIONS[username];
            const sector = sessionInfo.sector || '';
            if (SECTOR_PERMISSIONS[sector]) return SECTOR_PERMISSIONS[sector];
            return [];
        }

        function getGreeting() {
            const brasiliaTime = new Date().toLocaleString('en-US', { timeZone: 'America/Sao_Paulo', hour12: false });
            const hour = new Date(brasiliaTime).getHours();
            if (hour < 12) return 'Bom dia';
            if (hour < 18) return 'Boa tarde';
            return 'Boa noite';
        }

        function getOrCreateDeviceToken() {
            let token = localStorage.getItem('irDeviceToken');
            if (!token) {
                token = 'dev_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('irDeviceToken', token);
            }
            return token;
        }

        async function getPublicIP() {
            try {
                const res = await fetch(`${API_URL}/ip`);
                const data = await res.json();
                return data.ip;
            } catch { return null; }
        }

        function showMessage(message, type = 'error') {
            const box = document.getElementById('messageBox');
            box.textContent = message;
            box.className = `message ${type} show`;
            setTimeout(() => box.classList.remove('show'), 5000);
        }

        function togglePassword() {
            const input = document.getElementById('password');
            const btn   = document.querySelector('.toggle-password');
            if (input.type === 'password') { input.type = 'text';     btn.textContent = 'OCULTAR'; }
            else                           { input.type = 'password'; btn.textContent = 'MOSTRAR'; }
        }

        /* ── LOGOUT ── */
        function showLogoutModal()  { document.getElementById('logoutModal').classList.add('show'); }
        function closeLogoutModal() { document.getElementById('logoutModal').classList.remove('show'); }

        async function confirmLogout() {
            closeLogoutModal();
            try {
                const si = JSON.parse(sessionStorage.getItem('irUserSession'));
                if (si) {
                    await fetch(`${API_URL}/logout`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sessionToken: si.sessionToken, deviceToken: si.deviceToken })
                    });
                }
            } catch {}
            performLogout();
        }

        function performLogout() {
            sessionStorage.removeItem('irUserSession');
            document.getElementById('dashboardScreen').style.display = 'none';
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('password').value = '';
            document.getElementById('iframesContainer').innerHTML = '';
            sidebarRevealed = false;
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.remove('visible', 'expanded');
            document.getElementById('welcomeScreen').classList.remove('hidden-smooth');
            document.getElementById('logoutFloatingBtn').classList.remove('hidden-smooth');
            const wg = document.getElementById('welcomeGreeting');
            if (wg) wg.textContent = '';
        }

        /* ── SETUP SIDEBAR HOVER ── */
        function setupSidebarHover() {
            const sidebar = document.getElementById('sidebar');
            sidebar.addEventListener('mouseenter', () => {
                clearTimeout(hoverTimeout);
                if (sidebarRevealed) sidebar.classList.add('expanded');
            });
            sidebar.addEventListener('mouseleave', () => {
                hoverTimeout = setTimeout(() => sidebar.classList.remove('expanded'), 150);
            });
        }

        /* ── CARREGAR MÓDULOS NA SIDEBAR ── */
        function loadSidebarModules(sessionInfo) {
            const sidebarModules = document.getElementById('sidebarModules');
            sidebarModules.innerHTML = '';
            const perms = getUserPermissions(sessionInfo);
            MODULES.forEach(module => {
                if (!perms.includes(module.id)) return;
                const item = document.createElement('div');
                item.className = 'module-item';
                if (!module.available || !module.url) {
                    item.classList.add('disabled');
                    item.style.opacity = '0.4';
                    item.style.cursor  = 'not-allowed';
                } else {
                    item.id = `module-${module.id}`;
                    item.setAttribute('data-tooltip', module.name);
                    item.addEventListener('click', () => openModule(module));
                }
                const icon = MODULE_ICONS[module.id] || MODULE_ICONS['comercial'];
                item.innerHTML = `<span class="module-icon">${icon}</span><span class="module-label">${module.name}</span>`;
                sidebarModules.appendChild(item);
            });
        }

        /* ── CARREGAR CARDS NA TELA INICIAL ── */
        function loadWelcomeModules(sessionInfo) {
            const grid = document.getElementById('welcomeModulesGrid');
            grid.innerHTML = '';
            const perms = getUserPermissions(sessionInfo);
            MODULES.forEach(module => {
                if (!perms.includes(module.id)) return;
                const card = document.createElement('div');
                card.className = 'welcome-module-card';
                const icon = MODULE_ICONS[module.id] || MODULE_ICONS['comercial'];
                card.innerHTML = `<span class="card-icon">${icon}</span><span>${module.name}</span>`;
                if (!module.available || !module.url) {
                    card.classList.add('unavailable');
                } else {
                    card.addEventListener('click', () => openModule(module));
                }
                grid.appendChild(card);
            });
        }

        /* ── ABRIR MÓDULO ── */
        function openModule(module) {
            if (!sidebarRevealed) {
                sidebarRevealed = true;
                document.getElementById('sidebar').classList.add('visible');
                document.getElementById('logoutFloatingBtn').classList.add('hidden-smooth');
            }

            document.querySelectorAll('.module-item').forEach(i => i.classList.remove('active'));
            const sidebarItem = document.getElementById(`module-${module.id}`);
            if (sidebarItem) sidebarItem.classList.add('active');

            document.getElementById('welcomeScreen').classList.add('hidden-smooth');

            let iframeContainer = document.getElementById(`iframe-${module.id}`);
            if (!iframeContainer) {
                const params = new URLSearchParams({ sessionToken: currentSessionInfo.sessionToken });
                iframeContainer = document.createElement('div');
                iframeContainer.className = 'iframe-container';
                iframeContainer.id = `iframe-${module.id}`;

                const loader = document.createElement('div');
                loader.className = 'app-loader';
                loader.innerHTML = '<div class="app-loader-spinner"></div>';
                iframeContainer.appendChild(loader);

                const iframe = document.createElement('iframe');
                iframe.src = `${module.url}?${params}`;
                iframe.title = module.name;
                iframe.addEventListener('load', () => {
                    setTimeout(() => {
                        loader.classList.add('done');
                        setTimeout(() => loader.remove(), 500);
                    }, 3000);
                });
                iframeContainer.appendChild(iframe);
                document.getElementById('iframesContainer').appendChild(iframeContainer);
            }

            document.querySelectorAll('.iframe-container').forEach(c => c.classList.remove('active'));
            setTimeout(() => iframeContainer.classList.add('active'), 50);
            activeModuleId = module.id;
        }

        /* ── SHOW DASHBOARD ── */
        function showDashboard(sessionInfo) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').style.display = 'block';

            const greeting   = getGreeting();
            const userName   = sessionInfo.name || sessionInfo.username;
            const userSector = sessionInfo.sector || 'Usuário';

            document.getElementById('userInitial').textContent       = userName.charAt(0).toUpperCase();
            document.getElementById('sidebarUserName').textContent   = userName;
            document.getElementById('sidebarUserSector').textContent = userSector;

            const welcomeGreetingEl = document.getElementById('welcomeGreeting');
            if (welcomeGreetingEl) welcomeGreetingEl.textContent = `${greeting}, ${userName}!`;

            loadSidebarModules(sessionInfo);
            loadWelcomeModules(sessionInfo);
            setupSidebarHover();

            const splash = document.getElementById('splashWelcome');
            if (splash) {
                splash.style.display   = 'flex';
                splash.style.animation = 'none';
                void splash.offsetWidth;
                splash.style.animation = 'fadeOut 0.5s ease 2.5s forwards';
                setTimeout(() => { splash.style.display = 'none'; }, 3000);
            }
        }

        /* ── LOGIN ── */
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.toLowerCase().trim();
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span class="btn-spinner"></span> Autenticando...';
            try {
                const res  = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password, deviceToken })
                });
                const data = await res.json();
                if (!res.ok) { showMessage(data.message || data.error || 'Erro ao fazer login', 'error'); return; }
                if (data.success && data.session) {
                    sessionStorage.setItem('irUserSession', JSON.stringify(data.session));
                    currentSessionInfo = data.session;
                    showDashboard(data.session);
                }
            } catch { showMessage('Erro ao realizar login. Tente novamente.', 'error'); }
            finally  { loginBtn.disabled = false; loginBtn.innerHTML = 'Acessar Sistema'; }
        });

        /* ── VERIFY SESSION ── */
        async function verifySession(token) {
            try {
                const res  = await fetch(`${API_URL}/verify-session`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sessionToken: token })
                });
                const data = await res.json();
                return data.valid === true;
            } catch { return false; }
        }

        /* ── INIT ── */
        async function init() {
            try {
                deviceToken = getOrCreateDeviceToken();
                publicIP    = await getPublicIP();
                const stored = sessionStorage.getItem('irUserSession');
                if (stored) {
                    const session = JSON.parse(stored);
                    const valid   = await verifySession(session.sessionToken);
                    if (valid) { currentSessionInfo = session; showDashboard(session); }
                    else sessionStorage.removeItem('irUserSession');
                }
            } catch (e) { console.error('Erro na inicialização:', e); }
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
